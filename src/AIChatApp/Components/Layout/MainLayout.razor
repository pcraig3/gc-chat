@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@inject UserService UserService

@{
    var userId = UserService.GetUserIdAsync();
    var userClass = $"user--{userId ?? "null"}";
}

<CascadingValue Name="Culture" Value="@CurrentCulture">
    <div class="wrap @userClass">
        <SkipLink />
        <PhaseBanner />
        <Header />
        <main class="container">
            @Body
        </main>
        <Footer />
    </div>
</CascadingValue>

@code {
    private string CurrentCulture => GetCultureFromUrl();

    private string GetCultureFromUrl()
    {
        var uri = new Uri(NavigationManager.Uri);
        var path = uri.AbsolutePath;

        if (!string.IsNullOrEmpty(path))
        {
            var segments = path.Split('/', StringSplitOptions.RemoveEmptyEntries);
            if (segments.Length > 0)
            {
                var culture = segments[0].ToLowerInvariant();
                if (culture == "en" || culture == "fr")
                {
                    return culture;
                }
            }
        }

        return "en"; // Fallback to default
    }
}